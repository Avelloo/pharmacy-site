{"ast":null,"code":"import _toConsumableArray from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from'react';import socketIOClient from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ENDPOINT=window.location.host.indexOf('localhost')>=0?'http://127.0.0.1:5000':window.location.host;export default function ChatBox(props){var userInfo=props.userInfo;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var uiMessagesRef=useRef(null);var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOpen=_useState4[0],setIsOpen=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),messageBody=_useState6[0],setMessageBody=_useState6[1];var _useState7=useState([{name:'Администрация',body:'Привет, мы на связи! Задавайте вопросы.'}]),_useState8=_slicedToArray(_useState7,2),messages=_useState8[0],setMessages=_useState8[1];useEffect(function(){if(uiMessagesRef.current){uiMessagesRef.current.scrollBy({top:uiMessagesRef.current.clientHeight,left:0,behavior:'smooth'});}if(socket){socket.emit('onLogin',{_id:userInfo._id,name:userInfo.name,isAdmin:userInfo.isAdmin});socket.on('message',function(data){setMessages([].concat(_toConsumableArray(messages),[{body:data.body,name:data.name}]));});}},[messages,isOpen,socket]);var supportHandler=function supportHandler(){setIsOpen(true);console.log(ENDPOINT);var sk=socketIOClient(ENDPOINT);setSocket(sk);};var submitHandler=function submitHandler(e){e.preventDefault();if(!messageBody.trim()){alert('Ошибка. Пожалуйста введите сообщение.');}else{setMessages([].concat(_toConsumableArray(messages),[{body:messageBody,name:userInfo.name}]));setMessageBody('');setTimeout(function(){socket.emit('onMessage',{body:messageBody,name:userInfo.name,isAdmin:userInfo.isAdmin,_id:userInfo._id});},1000);}};var closeHandler=function closeHandler(){setIsOpen(false);};return/*#__PURE__*/_jsx(\"div\",{className:\"chatbox\",children:!isOpen?/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:supportHandler,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-support\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"card card-body shadow\",style:{backgroundColor:'white'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u041F\\u043E\\u0434\\u0434\\u0435\\u0440\\u0436\\u043A\\u0430 \"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:closeHandler,children:/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-close\"})})]}),/*#__PURE__*/_jsx(\"ul\",{ref:uiMessagesRef,children:messages.map(function(msg,index){return/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\".concat(msg.name,\": \")}),\" \",msg.body]},index);})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitHandler,className:\"row\",children:[/*#__PURE__*/_jsx(\"input\",{value:messageBody,onChange:function onChange(e){return setMessageBody(e.target.value);},type:\"text\",placeholder:\"\\u0432\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]})})]})});}","map":{"version":3,"sources":["C:/Users/aloob/Desktop/pharmacy-site/frontend/src/components/ChatBox.js"],"names":["React","useEffect","useRef","useState","socketIOClient","ENDPOINT","window","location","host","indexOf","ChatBox","props","userInfo","socket","setSocket","uiMessagesRef","isOpen","setIsOpen","messageBody","setMessageBody","name","body","messages","setMessages","current","scrollBy","top","clientHeight","left","behavior","emit","_id","isAdmin","on","data","supportHandler","console","log","sk","submitHandler","e","preventDefault","trim","alert","setTimeout","closeHandler","backgroundColor","map","msg","index","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport socketIOClient from 'socket.io-client';\n\nconst ENDPOINT =\n  window.location.host.indexOf('localhost') >= 0\n    ? 'http://127.0.0.1:5000'\n    : window.location.host;\n\nexport default function ChatBox(props) {\n  const { userInfo } = props;\n  const [socket, setSocket] = useState(null);\n  const uiMessagesRef = useRef(null);\n  const [isOpen, setIsOpen] = useState(false);\n  const [messageBody, setMessageBody] = useState('');\n  const [messages, setMessages] = useState([\n    { name: 'Администрация', body: 'Привет, мы на связи! Задавайте вопросы.' },\n  ]);\n\n  useEffect(() => {\n    if (uiMessagesRef.current) {\n      uiMessagesRef.current.scrollBy({\n        top: uiMessagesRef.current.clientHeight,\n        left: 0,\n        behavior: 'smooth',\n      });\n    }\n    if (socket) {\n      socket.emit('onLogin', {\n        _id: userInfo._id,\n        name: userInfo.name,\n        isAdmin: userInfo.isAdmin,\n      });\n      socket.on('message', (data) => {\n        setMessages([...messages, { body: data.body, name: data.name }]);\n      });\n    }\n  }, [messages, isOpen, socket]);\n\n  const supportHandler = () => {\n    setIsOpen(true);\n    console.log(ENDPOINT);\n    const sk = socketIOClient(ENDPOINT);\n    setSocket(sk);\n  };\n  const submitHandler = (e) => {\n    e.preventDefault();\n    if (!messageBody.trim()) {\n      alert('Ошибка. Пожалуйста введите сообщение.');\n    } else {\n      setMessages([...messages, { body: messageBody, name: userInfo.name }]);\n      setMessageBody('');\n      setTimeout(() => {\n        socket.emit('onMessage', {\n          body: messageBody,\n          name: userInfo.name,\n          isAdmin: userInfo.isAdmin,\n          _id: userInfo._id,\n        });\n      }, 1000);\n    }\n  };\n  const closeHandler = () => {\n    setIsOpen(false);\n  };\n  return (\n    <div className=\"chatbox\">\n      {!isOpen ? (\n        <button type=\"button\" onClick={supportHandler}>\n          <i className=\"fa fa-support\" />\n        </button>\n      ) : (\n        <div className=\"card card-body shadow\" style={{backgroundColor:'white'}}>\n          <div className=\"row\">\n            <strong>Поддержка </strong>\n            <button type=\"button\" onClick={closeHandler}>\n              <i className=\"fa fa-close\" />\n            </button>\n          </div>\n          <ul ref={uiMessagesRef}>\n            {messages.map((msg, index) => (\n              <li key={index}>\n                <strong>{`${msg.name}: `}</strong> {msg.body}\n              </li>\n            ))}\n          </ul>\n          <div>\n            <form onSubmit={submitHandler} className=\"row\">\n              <input\n                value={messageBody}\n                onChange={(e) => setMessageBody(e.target.value)}\n                type=\"text\"\n                placeholder=\"введите сообщение\"\n              />\n              <button type=\"submit\">Отправить</button>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}