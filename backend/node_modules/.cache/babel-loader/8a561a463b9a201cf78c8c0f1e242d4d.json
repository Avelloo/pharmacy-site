{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\aloob\\\\Desktop\\\\pharmacy-site\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useRef,useState}from\"react\";import{YMaps,Map,ZoomControl,FullscreenControl,SearchControl,GeolocationControl,Placemark}from\"react-yandex-maps\";import{USER_ADDRESS_MAP_CONFIRM}from\"../constants/userConstants\";import{useDispatch}from\"react-redux\";//import Axios from \"axios\";\nimport LoadingBox from\"../components/LoadingBox\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var newCoords=[];export default function MapScreen(props){var map=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),ymaps=_useState2[0],setYmaps=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),adress=_useState4[0],setAdress=_useState4[1];var key;var dispatch=useDispatch();useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:case\"end\":return _context.stop();}}},_callee);}));return function fetch(){return _ref.apply(this,arguments);};}();fetch();},[]);var adressHandler=function adressHandler(adress){setAdress(adress);};function clickHandler(){var location1=newCoords[0];var location2=newCoords[1];if(location1){dispatch({type:USER_ADDRESS_MAP_CONFIRM,payload:{lat:location1,lng:location2}});alert(\"Местоположение успешно сохранено.\\n\"+location1+' '+location2);console.log((location2?location2:'нет инфы лок2')+'  '+(location1?location1:'нет инфы лок1'));props.history.push(\"/shipping\");}else{alert(\"Выберите точку!\");}}function getAddress(coords,myPlacemark){myPlacemark.properties.set('iconCaption','поиск...');ymaps.geocode(coords).then(function(res){var firstGeoObject=res.geoObjects.get(0);myPlacemark.properties.set({// Формируем строку с данными об объекте.\niconCaption:[// Название населенного пункта или вышестоящее административно-территориальное образование.\nfirstGeoObject.getLocalities().length?firstGeoObject.getLocalities():firstGeoObject.getAdministrativeAreas(),// Получаем путь до топонима, если метод вернул null, запрашиваем наименование здания.\nfirstGeoObject.getAddressLine()].filter(Boolean).join(', ')// В качестве контента балуна задаем строку с адресом объекта.\n});setAdress(firstGeoObject.getAddressLine());});}return key!==''?/*#__PURE__*/_jsxs(\"div\",{style:{width:\"100%\",height:\"300px\"},children:[/*#__PURE__*/_jsx(YMaps,{query:{apikey:'0d6a5158-ba82-480c-84e8-c30771d0ae5b'},style:{width:\"100%\",height:\"300px\"},children:/*#__PURE__*/_jsxs(Map,{style:{width:\"100%\",height:\"300px\"},instanceRef:map,modules:[\"geoQuery\",\"Placemark\",\"geocode\",\"geoObject.addon.balloon\"],defaultState:{center:[55.796127,49.106414],zoom:12},onLoad:function onLoad(ymapsInstance){setYmaps(ymapsInstance);},options:{searchControlProvider:\"yandex#search\"},children:[/*#__PURE__*/_jsx(Placemark,{defaultGeometry:[55.796127,49.106414],options:{draggable:true},onDragEnd:function onDragEnd(e){return console.log(e.get('target').geometry.getCoordinates());}// Событие change связано с св-вом geometry инстанса метки,\n// поэтому onChange работать не будет, придется использовать instanceRef\n,instanceRef:function instanceRef(ref){if(ref){// По аналогии добавляем обработчик\nref.geometry.events.add(\"change\",function(e){newCoords=e.get(\"newCoordinates\");});ref.events.add('dragend',function(e){getAddress(ref.geometry.getCoordinates(),ref);ref.geometry.setCoordinates(newCoords);adressHandler((ref.geometry.getCoordinates(),ref).properties._data.balloonContent);});}}}),/*#__PURE__*/_jsx(ZoomControl,{}),/*#__PURE__*/_jsx(FullscreenControl,{}),/*#__PURE__*/_jsx(SearchControl,{}),/*#__PURE__*/_jsx(GeolocationControl,{})]})}),/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',display:\"flex\",justifyContent:'center',margin:\"10px auto\"},children:\"\\u0414\\u0432\\u0438\\u0433\\u0430\\u0439\\u0442\\u0435 \\u043C\\u0435\\u0442\\u043A\\u0443, \\u0447\\u0442\\u043E\\u0431\\u044B \\u0432\\u044B\\u0431\\u0440\\u0430\\u0442\\u044C \\u0430\\u0434\\u0440\\u0435\\u0441.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{width:'100%',display:\"flex\",justifyContent:'center',margin:\"10px auto\"},children:[\"\\u0412\\u0430\\u0448 \\u0430\\u0434\\u0440\\u0435\\u0441: \",adress]}),/*#__PURE__*/_jsx(\"button\",{className:\"\",style:{display:\"flex\",margin:\"10px auto\"},onClick:clickHandler,children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u044C\"})]}):/*#__PURE__*/_jsx(LoadingBox,{});}","map":{"version":3,"sources":["C:/Users/aloob/Desktop/pharmacy-site/frontend/src/screens/MapScreen.js"],"names":["React","useEffect","useRef","useState","YMaps","Map","ZoomControl","FullscreenControl","SearchControl","GeolocationControl","Placemark","USER_ADDRESS_MAP_CONFIRM","useDispatch","LoadingBox","newCoords","MapScreen","props","map","ymaps","setYmaps","adress","setAdress","key","dispatch","fetch","adressHandler","clickHandler","location1","location2","type","payload","lat","lng","alert","console","log","history","push","getAddress","coords","myPlacemark","properties","set","geocode","then","res","firstGeoObject","geoObjects","get","iconCaption","getLocalities","length","getAdministrativeAreas","getAddressLine","filter","Boolean","join","width","height","apikey","center","zoom","ymapsInstance","searchControlProvider","draggable","e","geometry","getCoordinates","ref","events","add","setCoordinates","_data","balloonContent","display","justifyContent","margin"],"mappings":"sZAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,MAA3B,CAAmCC,QAAnC,KAAmD,OAAnD,CACA,OACEC,KADF,CAEEC,GAFF,CAGEC,WAHF,CAIEC,iBAJF,CAKEC,aALF,CAMEC,kBANF,CAOEC,SAPF,KAQO,mBARP,CAUA,OAASC,wBAAT,KAAyC,4BAAzC,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA;AACA,MAAOC,CAAAA,UAAP,KAAuB,0BAAvB,C,wFAEA,GAAIC,CAAAA,SAAS,CAAG,EAAhB,CAEA,cAAe,SAASC,CAAAA,SAAT,CAAmBC,KAAnB,CAA0B,CACvC,GAAMC,CAAAA,GAAG,CAAGf,MAAM,CAAC,IAAD,CAAlB,CACA,cAA0BC,QAAQ,CAAC,IAAD,CAAlC,wCAAOe,KAAP,eAAcC,QAAd,eAEA,eAA4BhB,QAAQ,CAAC,EAAD,CAApC,yCAAOiB,MAAP,eAAeC,SAAf,eACA,GAAIC,CAAAA,GAAJ,CACA,GAAMC,CAAAA,QAAQ,CAAGX,WAAW,EAA5B,CAEAX,SAAS,CAAC,UAAM,CACd,GAAMuB,CAAAA,KAAK,0FAAG,kLAAH,kBAALA,CAAAA,KAAK,0CAAX,CAIAA,KAAK,GACN,CANQ,CAMN,EANM,CAAT,CAQA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACL,MAAD,CAAY,CAChCC,SAAS,CAACD,MAAD,CAAT,CAED,CAHD,CAIA,QAASM,CAAAA,YAAT,EAAwB,CAEtB,GAAIC,CAAAA,SAAS,CAAGb,SAAS,CAAC,CAAD,CAAzB,CACA,GAAIc,CAAAA,SAAS,CAAGd,SAAS,CAAC,CAAD,CAAzB,CACA,GAAGa,SAAH,CAAa,CACTJ,QAAQ,CAAC,CACLM,IAAI,CAAElB,wBADD,CAELmB,OAAO,CAAE,CACPC,GAAG,CAAEJ,SADE,CAEPK,GAAG,CAAEJ,SAFE,CAFJ,CAAD,CAAR,CAOEK,KAAK,CAAC,sCAAwCN,SAAxC,CAAoD,GAApD,CAA0DC,SAA3D,CAAL,CACAM,OAAO,CAACC,GAAR,CAAY,CAACP,SAAS,CAAGA,SAAH,CAAe,eAAzB,EAA4C,IAA5C,EAAoDD,SAAS,CAAGA,SAAH,CAAe,eAA5E,CAAZ,EACAX,KAAK,CAACoB,OAAN,CAAcC,IAAd,CAAmB,WAAnB,EACL,CAXD,IAWK,CACDJ,KAAK,CAAC,iBAAD,CAAL,CACH,CAGF,CAED,QAASK,CAAAA,UAAT,CAAoBC,MAApB,CAA4BC,WAA5B,CAAyC,CACvCA,WAAW,CAACC,UAAZ,CAAuBC,GAAvB,CAA2B,aAA3B,CAA0C,UAA1C,EACAxB,KAAK,CAACyB,OAAN,CAAcJ,MAAd,EAAsBK,IAAtB,CAA2B,SAAUC,GAAV,CAAe,CACtC,GAAIC,CAAAA,cAAc,CAAGD,GAAG,CAACE,UAAJ,CAAeC,GAAf,CAAmB,CAAnB,CAArB,CAEAR,WAAW,CAACC,UAAZ,CACKC,GADL,CACS,CACD;AACAO,WAAW,CAAE,CACT;AACAH,cAAc,CAACI,aAAf,GAA+BC,MAA/B,CAAwCL,cAAc,CAACI,aAAf,EAAxC,CAAyEJ,cAAc,CAACM,sBAAf,EAFhE,CAGT;AACAN,cAAc,CAACO,cAAf,EAJS,EAMXC,MANW,CAMJC,OANI,EAMKC,IANL,CAMU,IANV,CAOb;AATC,CADT,EAaInC,SAAS,CAACyB,cAAc,CAACO,cAAf,EAAD,CAAT,CACP,CAjBD,EAkBH,CACC,MAAO/B,CAAAA,GAAG,GAAK,EAAR,cACL,aAAK,KAAK,CAAE,CAAEmC,KAAK,CAAE,MAAT,CAAiBC,MAAM,CAAE,OAAzB,CAAZ,wBACE,KAAC,KAAD,EAAO,KAAK,CAAE,CAAEC,MAAM,CAAE,sCAAV,CAAd,CAAiE,KAAK,CAAE,CAAEF,KAAK,CAAE,MAAT,CAAiBC,MAAM,CAAE,OAAzB,CAAxE,uBACE,MAAC,GAAD,EACE,KAAK,CAAE,CAAED,KAAK,CAAE,MAAT,CAAiBC,MAAM,CAAE,OAAzB,CADT,CAEE,WAAW,CAAEzC,GAFf,CAGE,OAAO,CAAE,CACP,UADO,CAEP,WAFO,CAGP,SAHO,CAIP,yBAJO,CAHX,CASE,YAAY,CAAE,CACZ2C,MAAM,CAAE,CAAC,SAAD,CAAY,SAAZ,CADI,CAEZC,IAAI,CAAE,EAFM,CAThB,CAaE,MAAM,CAAE,gBAACC,aAAD,CAAmB,CACzB3C,QAAQ,CAAC2C,aAAD,CAAR,CACD,CAfH,CAgBE,OAAO,CAAE,CAAEC,qBAAqB,CAAE,eAAzB,CAhBX,wBAkBE,KAAC,SAAD,EACA,eAAe,CAAE,CAAC,SAAD,CAAY,SAAZ,CADjB,CAEE,OAAO,CAAE,CAAEC,SAAS,CAAE,IAAb,CAFX,CAGE,SAAS,CAAE,mBAAAC,CAAC,QAAI/B,CAAAA,OAAO,CAACC,GAAR,CAAY8B,CAAC,CAACjB,GAAF,CAAM,QAAN,EAAgBkB,QAAhB,CAAyBC,cAAzB,EAAZ,CAAJ,EACZ;AACA;AALF,CAME,WAAW,CAAE,qBAACC,GAAD,CAAS,CACpB,GAAIA,GAAJ,CAAS,CACP;AACAA,GAAG,CAACF,QAAJ,CAAaG,MAAb,CAAoBC,GAApB,CAAwB,QAAxB,CAAkC,SAAUL,CAAV,CAAa,CAC7CnD,SAAS,CAAGmD,CAAC,CAACjB,GAAF,CAAM,gBAAN,CAAZ,CAGD,CAJD,EAKAoB,GAAG,CAACC,MAAJ,CAAWC,GAAX,CAAe,SAAf,CAA0B,SAAUL,CAAV,CAAa,CACrC3B,UAAU,CAAC8B,GAAG,CAACF,QAAJ,CAAaC,cAAb,EAAD,CAAgCC,GAAhC,CAAV,CACAA,GAAG,CAACF,QAAJ,CAAaK,cAAb,CAA4BzD,SAA5B,EACAW,aAAa,CAAC,CAAC2C,GAAG,CAACF,QAAJ,CAAaC,cAAb,GAA+BC,GAAhC,EAAqC3B,UAArC,CAAgD+B,KAAhD,CAAsDC,cAAvD,CAAb,CACH,CAJC,EAMD,CACF,CArBH,EAlBF,cA0CE,KAAC,WAAD,IA1CF,cA2CE,KAAC,iBAAD,IA3CF,cA4CE,KAAC,aAAD,IA5CF,cA6CE,KAAC,kBAAD,IA7CF,GADF,EADF,cAkDE,YAAK,KAAK,CAAE,CAAEhB,KAAK,CAAC,MAAR,CAAgBiB,OAAO,CAAE,MAAzB,CAAgCC,cAAc,CAAE,QAAhD,CAA0DC,MAAM,CAAE,WAAlE,CAAZ,wMAlDF,cAmDE,aAAK,KAAK,CAAE,CAAEnB,KAAK,CAAC,MAAR,CAAgBiB,OAAO,CAAE,MAAzB,CAAgCC,cAAc,CAAE,QAAhD,CAA0DC,MAAM,CAAE,WAAlE,CAAZ,iEAA2GxD,MAA3G,GAnDF,cAoDE,eACE,SAAS,CAAC,EADZ,CAEE,KAAK,CAAE,CAAEsD,OAAO,CAAE,MAAX,CAAmBE,MAAM,CAAE,WAA3B,CAFT,CAGE,OAAO,CAAElD,YAHX,gFApDF,GADK,cA8DL,KAAC,UAAD,IA9DF,CAgED","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport {\n  YMaps,\n  Map,\n  ZoomControl,\n  FullscreenControl,\n  SearchControl,\n  GeolocationControl,\n  Placemark,\n} from \"react-yandex-maps\";\n\nimport { USER_ADDRESS_MAP_CONFIRM } from \"../constants/userConstants\";\nimport { useDispatch } from \"react-redux\";\n//import Axios from \"axios\";\nimport LoadingBox from \"../components/LoadingBox\";\n\nvar newCoords = [];\n\nexport default function MapScreen(props) {\n  const map = useRef(null);\n  const [ymaps, setYmaps] = useState(null);\n\n  const [adress, setAdress] = useState(\"\");\n  var key;\n  const dispatch = useDispatch();\n \n  useEffect(() => {\n    const fetch = async () => {\n      //const {data} = await Axios('/api/config/yandex');\n      //key = data;\n    };\n    fetch();\n  }, []);\n\n  const adressHandler = (adress) => {\n    setAdress(adress);\n\n  }\n  function clickHandler() {\n      \n    var location1 = newCoords[0];\n    var location2 = newCoords[1];\n    if(location1){\n        dispatch({\n            type: USER_ADDRESS_MAP_CONFIRM,\n            payload: {\n              lat: location1,\n              lng: location2,\n            },\n          });\n          alert(\"Местоположение успешно сохранено.\\n\" + location1 + ' ' + location2);\n          console.log((location2 ? location2 : 'нет инфы лок2') + '  ' + (location1 ? location1 : 'нет инфы лок1'));\n          props.history.push(\"/shipping\");\n    }else{\n        alert(\"Выберите точку!\");\n    } \n    \n    \n  }\n\n  function getAddress(coords, myPlacemark) {\n    myPlacemark.properties.set('iconCaption', 'поиск...');\n    ymaps.geocode(coords).then(function (res) {\n        var firstGeoObject = res.geoObjects.get(0);\n       \n        myPlacemark.properties\n            .set({\n                // Формируем строку с данными об объекте.\n                iconCaption: [\n                    // Название населенного пункта или вышестоящее административно-территориальное образование.\n                    firstGeoObject.getLocalities().length ? firstGeoObject.getLocalities() : firstGeoObject.getAdministrativeAreas(),\n                    // Получаем путь до топонима, если метод вернул null, запрашиваем наименование здания.\n                    firstGeoObject.getAddressLine(),\n\n                ].filter(Boolean).join(', '),\n                // В качестве контента балуна задаем строку с адресом объекта.\n                \n            });\n            setAdress(firstGeoObject.getAddressLine())\n    });\n}\n  return key !== '' ? (\n    <div style={{ width: \"100%\", height: \"300px\" }}>\n      <YMaps query={{ apikey: '0d6a5158-ba82-480c-84e8-c30771d0ae5b'}} style={{ width: \"100%\", height: \"300px\" }}>\n        <Map\n          style={{ width: \"100%\", height: \"300px\" }}\n          instanceRef={map}\n          modules={[\n            \"geoQuery\",\n            \"Placemark\",\n            \"geocode\",\n            \"geoObject.addon.balloon\",\n          ]}\n          defaultState={{\n            center: [55.796127, 49.106414],\n            zoom: 12,\n          }}\n          onLoad={(ymapsInstance) => {\n            setYmaps(ymapsInstance);\n          }}\n          options={{ searchControlProvider: \"yandex#search\" }}\n        >\n          <Placemark\n          defaultGeometry={[55.796127, 49.106414]}\n            options={{ draggable: true }}\n            onDragEnd={e => console.log(e.get('target').geometry.getCoordinates())}\n            // Событие change связано с св-вом geometry инстанса метки,\n            // поэтому onChange работать не будет, придется использовать instanceRef\n            instanceRef={(ref) => {\n              if (ref) {\n                // По аналогии добавляем обработчик\n                ref.geometry.events.add(\"change\", function (e) {\n                  newCoords = e.get(\"newCoordinates\");\n                  \n                  \n                });\n                ref.events.add('dragend', function (e) {\n                  getAddress(ref.geometry.getCoordinates(), ref);\n                  ref.geometry.setCoordinates(newCoords)\n                  adressHandler((ref.geometry.getCoordinates(), ref).properties._data.balloonContent);\n              });\n      \n              }\n            }}\n          />\n\n          <ZoomControl />\n          <FullscreenControl />\n          <SearchControl />\n          <GeolocationControl />\n        </Map>\n      </YMaps>\n      <div style={{ width:'100%', display: \"flex\",justifyContent: 'center', margin: \"10px auto\",  }}>Двигайте метку, чтобы выбрать адрес.</div>\n      <div style={{ width:'100%', display: \"flex\",justifyContent: 'center', margin: \"10px auto\",  }}>Ваш адрес: {adress}</div>\n      <button\n        className=\"\"\n        style={{ display: \"flex\", margin: \"10px auto\" }}\n        onClick={clickHandler}\n      >\n        Подтвердить\n      </button>\n    </div>\n  ): (\n    <LoadingBox></LoadingBox>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}