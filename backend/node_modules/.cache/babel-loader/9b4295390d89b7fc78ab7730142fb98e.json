{"ast":null,"code":"import _toConsumableArray from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/aloob/Desktop/pharmacy-site/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{Link}from\"react-router-dom\";import{createReview,detailsProducts}from\"../actions/productActions\";import LoadingBox from\"../components/LoadingBox\";import MessageBox from\"../components/MessageBox\";import Rating from\"../components/Rating\";import{PRODUCT_REVIEW_CREATE_RESET}from\"../constants/productConstants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function ProductScreen(props){var dispatch=useDispatch();var productId=props.match.params.id;var _useState=useState(1),_useState2=_slicedToArray(_useState,2),qty=_useState2[0],setQty=_useState2[1];var productDetails=useSelector(function(state){return state.productDetails;});var loading=productDetails.loading,error=productDetails.error,product=productDetails.product;var userSignin=useSelector(function(state){return state.userSignin;});var userInfo=userSignin.userInfo;var productReviewCreate=useSelector(function(state){return state.productReviewCreate;});var loadingReviewCreate=productReviewCreate.loading,errorReviewCreate=productReviewCreate.error,successReviewCreate=productReviewCreate.success;var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rating=_useState4[0],setRating=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),comment=_useState6[0],setComment=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),userPrescript=_useState8[0],setUserPrescript=_useState8[1];useEffect(function(){if(successReviewCreate){window.alert(\"Отзыв опубликован\");setRating(\"\");setComment(\"\");dispatch({type:PRODUCT_REVIEW_CREATE_RESET});}dispatch(detailsProducts(productId));},[dispatch,productId,successReviewCreate]);var addToCartHandler=function addToCartHandler(){if(product.isPrescripted){if(userPrescript==product.prescript){props.history.push(\"/cart/\".concat(productId,\"?qty=\").concat(qty));}else{if(userPrescript==''){alert(\"Введите хеш рецепта!\");}else{alert(\"Хеш рецепта не подходит!\");}}}else{props.history.push(\"/cart/\".concat(productId,\"?qty=\").concat(qty));}};var submitHandler=function submitHandler(e){e.preventDefault();if(comment&&rating){dispatch(createReview(productId,{rating:rating,comment:comment,name:userInfo.name}));}else{alert(\"Пожалуйста введите отзыв и поставьте рейтинг.\");}};return/*#__PURE__*/_jsxs(_Fragment,{children:[loading?/*#__PURE__*/_jsx(LoadingBox,{}):/*#__PURE__*/_jsxs(\"div\",{className:\"productHeader\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"productTitle\",children:product.name}),/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsx(Rating,{rating:product.rating,numReviews:product.numReviews})})]}),loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row-top-product\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"productBlock shadow\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"img-product\",src:product.image,alt:product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-product card-body\",style:{boxShadow:'0px 0px 0px 0px',border:'0px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041F\\u043E\\u0441\\u0442\\u0430\\u0432\\u0449\\u0438\\u043A\",/*#__PURE__*/_jsx(\"h2\",{children:/*#__PURE__*/_jsx(Link,{to:\"/provider/\".concat(product.provider._id),children:product.provider})})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u0426\\u0435\\u043D\\u0430:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"price\",children:[product.price,\" \\u0420\\u0443\\u0431.\"]})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",style:{margin:'1rem 0'},children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441:\"}),/*#__PURE__*/_jsx(\"div\",{children:product.countInStock>0?/*#__PURE__*/_jsx(\"span\",{className:\"success\",style:{marginLeft:'1rem'},children:\"\\u0415\\u0441\\u0442\\u044C \\u0432 \\u043D\\u0430\\u043B\\u0438\\u0447\\u0438\\u0438\"}):/*#__PURE__*/_jsx(\"span\",{className:\"danger\",style:{marginLeft:'1rem'},children:\"\\u0422\\u043E\\u0432\\u0430\\u0440 \\u043E\\u0442\\u0441\\u0443\\u0442\\u0441\\u0442\\u0432\\u0443\\u0435\\u0442\"})})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",style:{margin:'1rem 0'},children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u0420\\u0435\\u0446\\u0435\\u043F\\u0442:\"}),/*#__PURE__*/_jsx(\"div\",{children:product.isPrescripted?/*#__PURE__*/_jsx(\"span\",{className:\"danger\",style:{marginLeft:'1rem'},children:\"\\u0422\\u0440\\u0435\\u0431\\u0443\\u0435\\u0442\\u0441\\u044F \\u0440\\u0435\\u0446\\u0435\\u043F\\u0442\"}):/*#__PURE__*/_jsx(\"span\",{className:\"success\",style:{marginLeft:'1rem'},children:\"\\u0420\\u0435\\u0446\\u0435\\u043F\\u0442 \\u043D\\u0435 \\u043D\\u0443\\u0436\\u0435\\u043D\"})})]})}),product.isPrescripted?/*#__PURE__*/_jsxs(\"div\",{className:\"\",style:{margin:'2rem 0',borderRadius:'1rem'},children:[/*#__PURE__*/_jsx(\"p\",{style:{margin:'2rem 0',padding:'0,5rem'},children:\"\\u042D\\u0442\\u043E \\u0440\\u0435\\u0446\\u0435\\u043F\\u0442\\u0443\\u0440\\u043D\\u044B\\u0439 \\u043F\\u0440\\u0435\\u043F\\u0430\\u0440\\u0430\\u0442. \\u041F\\u0435\\u0440\\u0435\\u0434 \\u0434\\u043E\\u0431\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u0435\\u043C \\u0435\\u0433\\u043E \\u0432 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0443 \\u0432\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0445\\u0435\\u0448 \\u0440\\u0435\\u0446\\u0435\\u043F\\u0442\\u0430 \\u043D\\u0438\\u0436\\u0435:\"}),/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){return setUserPrescript(e.target.value);},className:\"shadow\",style:{width:'210px',backgroundColor:'#b5ccff',borderRadius:'0 0 1rem 1rem'}})]}):'',product.countInStock>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"qtySelector\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u041A\\u043E\\u043B-\\u0432\\u043E:\"}),/*#__PURE__*/_jsx(\"select\",{value:qty,onChange:function onChange(e){return setQty(e.target.value);},children:_toConsumableArray(Array(product.countInStock).keys()).map(function(x){return/*#__PURE__*/_jsx(\"option\",{value:x+1,children:x+1},x+1);})})]}),/*#__PURE__*/_jsx(\"button\",{style:{margin:\"o auto\"},onClick:addToCartHandler,className:\"primary block\",children:\"\\u0412 \\u043A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0443\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"description_list_container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"description_list\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"product-description\",dangerouslySetInnerHTML:{__html:product.description}})})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"reviewsSection\",children:[loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(\"div\",{className:\" reviewsBlock shadow\",style:{height:'100%'},children:[/*#__PURE__*/_jsx(\"h2\",{id:\"reviews\",children:\"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"}),product.reviews.length===0&&/*#__PURE__*/_jsx(MessageBox,{children:\"\\u0415\\u0449\\u0451 \\u043D\\u0438\\u043A\\u0442\\u043E \\u043D\\u0435 \\u043E\\u0441\\u0442\\u0430\\u0432\\u0438\\u043B \\u043E\\u0442\\u0437\\u044B\\u0432. \\u0411\\u0443\\u0434\\u044C\\u0442\\u0435 \\u043F\\u0435\\u0440\\u0432\\u044B\\u043C\\u0438!\"}),/*#__PURE__*/_jsx(\"ul\",{children:product.reviews.map(function(review){return/*#__PURE__*/_jsxs(\"li\",{className:\"\",style:{padding:'1rem',margon:'1rem 0',backgroundColor:'rgba(69, 123, 157, 0.06)',borderRadius:'1rem'},children:[/*#__PURE__*/_jsx(\"strong\",{children:review.name}),/*#__PURE__*/_jsx(Rating,{rating:review.rating,caption:\" \"}),/*#__PURE__*/_jsx(\"p\",{children:review.createdAt.substring(0,10)}),/*#__PURE__*/_jsx(\"p\",{children:review.comment})]},review._id);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\" leaveReview shadow\",children:userInfo?/*#__PURE__*/_jsxs(\"form\",{className:\"form\",onSubmit:submitHandler,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432:\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"rating\",children:\"\\u0420\\u0435\\u0439\\u0442\\u0438\\u043D\\u0433\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"rating\",value:rating,onChange:function onChange(e){return setRating(e.target.value);},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"1\",children:\"1- \\u0423\\u0436\\u0430\\u0441\\u043D\\u043E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"2\",children:\"2- \\u041F\\u043B\\u043E\\u0445\\u043E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"3\",children:\"3- \\u0425\\u043E\\u0440\\u043E\\u0448\\u043E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4- \\u041E\\u0447\\u0435\\u043D\\u044C \\u0445\\u043E\\u0440\\u043E\\u0448\\u043E\"}),/*#__PURE__*/_jsx(\"option\",{value:\"5\",children:\"5- \\u041E\\u0442\\u043B\\u0438\\u0447\\u043D\\u043E\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"comment\",children:\"\\u041E\\u0442\\u0437\\u044B\\u0432\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"comment\",value:comment,onChange:function onChange(e){return setComment(e.target.value);}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{}),/*#__PURE__*/_jsx(\"button\",{className:\"primary\",type:\"submit\",style:{width:\"100%\"},children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[loadingReviewCreate&&/*#__PURE__*/_jsx(LoadingBox,{}),errorReviewCreate&&/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:errorReviewCreate})]})]}):/*#__PURE__*/_jsxs(MessageBox,{children:[\"\\u041F\\u043E\\u0436\\u0430\\u043B\\u0443\\u0439\\u0441\\u0442\\u0430 \",/*#__PURE__*/_jsx(Link,{to:\"/signin\",children:\"\\u0432\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435 \\u0432 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442\"}),\", \\u0447\\u0442\\u043E\\u0431\\u044B \\u043E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432.\"]})})]})]})})]});}","map":{"version":3,"sources":["C:/Users/aloob/Desktop/pharmacy-site/frontend/src/screens/ProductScreen.js"],"names":["React","useEffect","useState","useDispatch","useSelector","Link","createReview","detailsProducts","LoadingBox","MessageBox","Rating","PRODUCT_REVIEW_CREATE_RESET","ProductScreen","props","dispatch","productId","match","params","id","qty","setQty","productDetails","state","loading","error","product","userSignin","userInfo","productReviewCreate","loadingReviewCreate","errorReviewCreate","successReviewCreate","success","rating","setRating","comment","setComment","userPrescript","setUserPrescript","window","alert","type","addToCartHandler","isPrescripted","prescript","history","push","submitHandler","e","preventDefault","name","numReviews","image","boxShadow","border","provider","_id","price","margin","countInStock","marginLeft","borderRadius","padding","target","value","width","backgroundColor","Array","keys","map","x","__html","description","height","reviews","length","review","margon","createdAt","substring"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Link } from \"react-router-dom\";\nimport { createReview, detailsProducts } from \"../actions/productActions\";\nimport LoadingBox from \"../components/LoadingBox\";\nimport MessageBox from \"../components/MessageBox\";\nimport Rating from \"../components/Rating\";\nimport { PRODUCT_REVIEW_CREATE_RESET } from \"../constants/productConstants\";\n\n\nexport default function ProductScreen(props) {\n  const dispatch = useDispatch();\n  const productId = props.match.params.id;\n  const [qty, setQty] = useState(1);\n  const productDetails = useSelector((state) => state.productDetails);\n  const { loading, error, product } = productDetails;\n  const userSignin = useSelector((state) => state.userSignin);\n  const { userInfo } = userSignin;\n\n  const productReviewCreate = useSelector((state) => state.productReviewCreate);\n  const {\n    loading: loadingReviewCreate,\n    error: errorReviewCreate,\n    success: successReviewCreate,\n  } = productReviewCreate;\n\n  const [rating, setRating] = useState(0);\n  const [comment, setComment] = useState(\"\");\n  const [userPrescript, setUserPrescript] = useState(\"\");\n\n  useEffect(() => {\n    if (successReviewCreate) {\n      window.alert(\"Отзыв опубликован\");\n      setRating(\"\");\n      setComment(\"\");\n      dispatch({ type: PRODUCT_REVIEW_CREATE_RESET });\n    }\n    dispatch(detailsProducts(productId));\n  }, [dispatch, productId, successReviewCreate]);\n\n  const addToCartHandler = () => {\n    if(product.isPrescripted){\n      if(userPrescript == product.prescript){\n        props.history.push(`/cart/${productId}?qty=${qty}`);\n      }else{\n        if(userPrescript == ''){\n          alert(\"Введите хеш рецепта!\");\n        }else{\n          alert(\"Хеш рецепта не подходит!\");\n        }\n       \n      }\n    }else{\n      props.history.push(`/cart/${productId}?qty=${qty}`);\n    }\n\n  };\n\n  const submitHandler = (e) => {\n    e.preventDefault();\n    if (comment && rating) {\n      dispatch(\n        createReview(productId, { rating, comment, name: userInfo.name })\n      );\n    } else {\n      alert(\"Пожалуйста введите отзыв и поставьте рейтинг.\");\n    }\n  };\n\n\n  return (\n    <>\n      {loading ? (\n        <LoadingBox></LoadingBox>\n      ) : (\n        <div className=\"productHeader\">\n          <h1 className=\"productTitle\">{product.name}</h1>\n          <div className=\"\">\n            <Rating\n              rating={product.rating}\n              numReviews={product.numReviews}\n            ></Rating>\n          </div>\n        </div>\n      )}\n      {loading ? (\n        <LoadingBox></LoadingBox>\n      ) : error ? (\n        <MessageBox variant=\"danger\">{error}</MessageBox>\n      ) : (\n        <>\n          <div className=\"row-top-product\">\n            <div className=\"productBlock shadow\">\n              <img\n                className=\"img-product\"\n                src={product.image}\n                alt={product.name}\n              ></img>\n              <div className=\"card-product card-body\" style={{boxShadow:'0px 0px 0px 0px', border:'0px'}}>\n                <div>\n                  Поставщик\n                  <h2>\n                    <Link to={`/provider/${product.provider._id}`}>\n                    {product.provider}\n                    </Link>\n                  </h2>\n                </div>\n                <div>\n                  <div className=\"row\">\n                    <div>Цена:</div>\n                    <div className=\"price\">{product.price} Руб.</div>\n                  </div>\n                </div>\n                <div>\n                  <div className=\"row\" style={{margin:'1rem 0'}}>\n                    <div>Статус:</div>\n                    <div>\n                      {product.countInStock > 0 ? (\n                        <span className=\"success\" style={{marginLeft: '1rem'}}>Есть в наличии</span>\n                      ) : (\n                        <span className=\"danger\"  style={{marginLeft: '1rem'}} >Товар отсутствует</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <div>\n                  <div className=\"row\" style={{margin:'1rem 0'}}>\n                    <div>Рецепт:</div>\n                    <div>\n                      {product.isPrescripted? (\n                        <span className=\"danger\"  style={{marginLeft: '1rem'}} >Требуется рецепт</span>\n                      ) : (\n                        <span className=\"success\" style={{marginLeft: '1rem'}}>Рецепт не нужен</span>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                {product.isPrescripted? (\n                  <div className=\"\" style={{margin:'2rem 0', borderRadius:'1rem'}}>\n                   <p style={{margin:'2rem 0', padding:'0,5rem'}}>Это рецептурный препарат. Перед добавлением его в корзину введите хеш рецепта ниже:</p>\n                   <input onChange={e => setUserPrescript(e.target.value)} className=\"shadow\" style={{width:'210px', backgroundColor:'#b5ccff', borderRadius:'0 0 1rem 1rem'}}></input>\n                 </div>\n                ) : (\n                 ''\n                )}\n                 \n                {product.countInStock > 0 && (\n                  <>\n                    <div className=\"qtySelector\">\n                      <div>Кол-во:</div>\n                      <select\n                        value={qty}\n                        onChange={(e) => setQty(e.target.value)}\n                      >\n                        {[...Array(product.countInStock).keys()].map((x) => (\n                          <option key={x + 1} value={x + 1}>\n                            {x + 1}\n                          </option>\n                        ))}\n                      </select>\n                    </div>\n\n                    <button\n                      style={{ margin: \"o auto\" }}\n                      onClick={addToCartHandler}\n                      className=\"primary block\"\n                    >\n                      В корзину\n                    </button>\n                  </>\n                )}\n              </div>\n            </div>\n\n            <div className=\"description_list_container\">\n              <div className=\"description_list\">\n                <div>\n                  <div\n                    className=\"product-description\"\n                    dangerouslySetInnerHTML={{\n                      __html: product.description,\n                    }}\n                  ></div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"reviewsSection\">\n              {loading ? (\n                <LoadingBox></LoadingBox>\n              ) : error ? (\n                <MessageBox variant=\"danger\">{error}</MessageBox>\n              ) : (\n                <div className=\" reviewsBlock shadow\" style={{height:'100%'}}>\n                  <h2 id=\"reviews\">Отзывы</h2>\n                  {product.reviews.length === 0 && (\n                    <MessageBox>\n                      Ещё никто не оставил отзыв. Будьте первыми!\n                    </MessageBox>\n                  )}\n                  <ul>\n                    {product.reviews.map((review) => (\n                      <li key={review._id} className='' style={{padding:'1rem', margon:'1rem 0', backgroundColor:'rgba(69, 123, 157, 0.06)', borderRadius:'1rem'}}>\n                        <strong>{review.name}</strong>\n                        <Rating rating={review.rating} caption=\" \"></Rating>\n                        <p>{review.createdAt.substring(0, 10)}</p>\n                        <p>{review.comment}</p>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              <div className=\" leaveReview shadow\">\n                {userInfo ? (\n                  <form className=\"form\" onSubmit={submitHandler}>\n                    <div>\n                      <h2>Оставить отзыв:</h2>\n                    </div>\n                    <div>\n                      <label htmlFor=\"rating\">Рейтинг</label>\n                      <select\n                        id=\"rating\"\n                        value={rating}\n                        onChange={(e) => setRating(e.target.value)}\n                      >\n                        <option value=\"\">Выберите...</option>\n                        <option value=\"1\">1- Ужасно</option>\n                        <option value=\"2\">2- Плохо</option>\n                        <option value=\"3\">3- Хорошо</option>\n                        <option value=\"4\">4- Очень хорошо</option>\n                        <option value=\"5\">5- Отлично</option>\n                      </select>\n                    </div>\n                    <div>\n                      <label htmlFor=\"comment\">Отзыв</label>\n                      <textarea\n                        id=\"comment\"\n                        value={comment}\n                        onChange={(e) => setComment(e.target.value)}\n                      ></textarea>\n                    </div>\n                    <div>\n                      <label />\n                      <button\n                        className=\"primary\"\n                        type=\"submit\"\n                        style={{ width: \"100%\" }}\n                      >\n                        Отправить\n                      </button>\n                    </div>\n                    <div>\n                      {loadingReviewCreate && <LoadingBox></LoadingBox>}\n                      {errorReviewCreate && (\n                        <MessageBox variant=\"danger\">\n                          {errorReviewCreate}\n                        </MessageBox>\n                      )}\n                    </div>\n                  </form>\n                ) : (\n                  <MessageBox>\n                    Пожалуйста <Link to=\"/signin\">войдите в аккаунт</Link>,\n                    чтобы оставить отзыв.\n                  </MessageBox>\n                )}\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}